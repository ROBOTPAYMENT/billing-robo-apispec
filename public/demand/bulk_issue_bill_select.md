# 請求書発行

`/api/v1.0/demand/bulk_issue_bill_select`

請求書発行をAPIで行う場合に利用します。
リクエスト上限は1000件です。

## アウトライン

- [リクエスト](#リクエスト)
- [レスポンス](#レスポンス)
- [使用例](#使用例)
  - [リクエスト例](#リクエスト例)
  - [レスポンス例](#レスポンス例)
- [エラー](#エラー)

## リクエスト
- Path: `/api/v1.0/demand/bulk_issue_bill_select`
- Preferred HTTP method: `POST`
- Accepted content types: `application/json`
- Encode: `UTF-8`

### Parameters

| 名前                       | 概要                          | 桁数 | 種別                            | 必須 |
| ------------------------- | ---------------------------- | --- | -----------------------------  | --- |
| user_id                   | ユーザーID（管理画面へのログインID） | 100 | [メール形式](../../index.md#種別) | 必須 |
| access_key                | アクセスキー                    | 100 | [半角英数](../../index.md#種別)   | 必須 |
| [demand](#demand-request) | 請求情報に属するパラメータ          |     | `array`                       |     |

#### demand (request)

下記のような項目のオブジェクトを持つリスト

| 名前   | 概要           | 桁数 | 種別   | 必須     |
| ------ | -------------- | ---- | ------ | -------- |
| number | 請求情報番号   | 18  | 数値 | (必須)^1 |
| code   | 請求情報コード | 20  | [半角英数 + 記号](../../index.md#種別) | (必須)^1 |


## レスポンス

- Type: `application/json`
- Encode: `UTF-8`

### Fields

| 名前                        | 概要                  | 型      |
| -------------------------- | -------------------- | ------ |
| user_id                    | ユーザーID             | string |
| access_key                 | アクセスキー            | string |
| [demand](#demand-response) | 請求情報に属するパラメータ | `array` |

#### demand (response)

下記のような項目のオブジェクトを持つリスト

| 名前               | 概要                           | 型      |
| ----------------- | ----------------------------- | ------ |
| error_code        | エラーコード <br> ※正常時はnull    | int    |
| error_message     | エラーメッセージ <br> ※正常時はnull | string |
| number            | 請求情報番号                     | int    |
| code              | 請求情報コード                    | string |
| demand.sales.bill | 請求書に属するパラメータ            |        |
| number            | 請求書番号                       | string |
| issue_date        | 請求書発行日                     | date   |


## 使用例

### リクエスト例

```json
{
    "user_id": "sample@robotpayment.co.jp",
    "access_key": "xxxxxxxxxxxxxxxx",
    "demand": [
        {
            "number": "1",
            "code": "1001"
        }
    ]
}
```

### レスポンス例

Status: 200 OK

```json
{
    "user_id": "sample@robotpayment.co.jp",
    "access_key": "xxxxxxxxxxxxxxxx",
    "demand": [
        {
            "error_code": null,
            "error_message": null,
            "number": "1",
            "code": "1001",
            "sales": [
                {
                    "bill": [
                        {
                            "number": "201805-1001-1",
                            "issue_date": "2018/05/01"
                        }
                    ]
                }
            ]
        }
    ]
}
```

## エラー

[共通エラー](../../index.md#共通エラー)

個別エラー

| エラーコード | 内容                                                                 |
| --------- | ------------------------------------------------------------------- |
| 3301      | 発行日がまだ来ていません                                                  |
| 3302      | 売上または請求書が既に発行されています                                        |
| 3303      | 承認中の請求情報が選択されています                                           |
| 3304      | 請求先部署が停止されている請求情報が選択されています                             |
| 3305      | 請求先が停止または削除されている請求情報が選択されています                         |
| 3306      | 請求情報が停止または削除されている請求情報が選択されています                       |
| 3307      | 定期従量以外で数量が0の請求情報が選択されています                               |
| 3308      | 合計請求書の請求先部署が停止または削除されている請求情報が選択されています             |
| 3309      | 合計請求書の請求先部署の決済手段が停止または削除されている請求情報が選択されています     |
| 3310      | 条件に一致するデータが存在しません                                           |
| 3311      | 売上が作成されました。請求書は請求書発行日に作成されます。※全件処理は中断しません       |
| 3312      | 請求情報が定期従量で数量が0のため、請求書発行をスキップしました。※全件処理は中断しません |
| 3313      | 他の請求書が発行に失敗したので発行しませんでした                                |
| 3314      | 内部的なエラーにより売上が作成されず請求書発行に失敗しました                       |
| 3315      | 請求情報番号が不正                                                      |
| 3316      | 請求情報コードが不正                                                     |
| 3317      | 決済手段が停止または削除されている請求情報が選択されています                       |
| 3318      | リクエストにdemandオブジェクトがありません                                   |
| 3319      | 請求情報番号と請求情報コードはいずれか必須です                                 |
| 3320      | 請求情報番号と請求情報コードのいずれかが重複しています                           |
| 3321      | 定期従量で数量が0で発行日が未来日の請求情報が選択されています                      |
| 3322      | 売上が作成されましたが、請求書発行に失敗しました。※全件処理は中断しません            |

----

[TOPへ戻る](../../index.md)